EXPLAIN
SELECT
	ADDRESS_ID,
	ADDRESS,
	DISTRICT,
	PHONE
FROM
	ADDRESS
WHERE
	PHONE = '223664661973';

-- CREATE INDEX
CREATE INDEX IDX_ADDRESS_PHONE ON ADDRESS (PHONE);

SELECT
	INDEXNAME,
	INDEXDEF
FROM
	PG_INDEXES
WHERE
	TABLENAME = 'address';

-- INDEX ON EXPREESSION
-- Will use index scan
EXPLAIN
SELECT
	CUSTOMER_ID,
	FIRST_NAME,
	LAST_NAME
FROM
	CUSTOMER
WHERE
	LAST_NAME = 'Purdy';

-- Will use sequential scan
EXPLAIN
SELECT
	CUSTOMER_ID,
	FIRST_NAME,
	LAST_NAME
FROM
	CUSTOMER
WHERE
	LOWER(LAST_NAME) = 'purdy';

-- CREATE INDEX ON EXPRESSION
CREATE INDEX IDX_LC_LAST_NAME ON CUSTOMER (LOWER(LAST_NAME));

-- PARTIAL INDEX
CREATE INDEX CUSTOMER_ACTIVE ON CUSTOMER (ACTIVE)
WHERE
	ACTIVE = 0;

EXPLAIN
SELECT
	*
FROM
	CUSTOMER
WHERE
	ACTIVE = 0;

-- REINDEX
REINDEX (VERBOSE, CONCURRENTLY) SCHEMA PUBLIC;

DROP INDEX IDX_LC_LAST_NAME;

-- List indexes
SELECT
	TABLENAME,
	INDEXNAME,
	INDEXDEF
FROM
	PG_INDEXES
WHERE
	SCHEMANAME = 'public'
ORDER BY
	TABLENAME,
	INDEXNAME;

-- HASH INDEX
SELECT
	*
FROM
	PAYMENT;

EXPLAIN
SELECT
	*
FROM
	PAYMENT
WHERE
	AMOUNT = 7.99;

EXPLAIN
SELECT
	*
FROM
	PAYMENT
WHERE
	AMOUNT < 8;

CREATE INDEX IDX_AMOUNT_HASH ON PAYMENT USING HASH (AMOUNT);

-- Covering INDEX
EXPLAIN
SELECT
	DESCRIPTION
FROM
	FILM
WHERE
	TITLE = 'Airport Pollock';

CREATE INDEX IDX_RELEASE_YEAR_FILM ON FILM (TITLE) INCLUDE (DESCRIPTION);


-- BRIN INDEX
CREATE INDEX idx_rental_date_brin
ON rental
USING brin (rental_date);

EXPLAIN
SELECT *
FROM rental
WHERE rental_date BETWEEN '2005-05-01' AND '2005-05-07';
