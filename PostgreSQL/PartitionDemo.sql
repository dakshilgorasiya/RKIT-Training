CREATE TABLE SALES (
	ID BIGINT,
	SALE_DATE DATE,
	COUNTRY TEXT,
	AMOUNT NUMERIC
)
PARTITION BY
	RANGE (SALE_DATE);

CREATE TABLE SALES_2024 PARTITION OF SALES FOR
VALUES
FROM
	('2024-01-01') TO ('2025-01-01')
PARTITION BY
	LIST (COUNTRY);

CREATE TABLE SALES_2025 PARTITION OF SALES FOR
VALUES
FROM
	('2025-01-01') TO ('2026-01-01')
PARTITION BY
	LIST (COUNTRY);

CREATE TABLE SALES_2024_INDIA PARTITION OF SALES_2024 FOR
VALUES
	IN ('India');

CREATE TABLE SALES_2024_USA PARTITION OF SALES_2024 FOR
VALUES
	IN ('USA');

CREATE TABLE SALES_2024_OTHER PARTITION OF SALES_2024 DEFAULT;

CREATE TABLE SALES_2025_INDIA PARTITION OF SALES_2025 FOR
VALUES
	IN ('India');

CREATE TABLE SALES_2025_USA PARTITION OF SALES_2025 FOR
VALUES
	IN ('USA');

CREATE TABLE SALES_2025_OTHER PARTITION OF SALES_2025 DEFAULT;

INSERT INTO
	SALES
VALUES
	(1, '2024-06-10', 'India', 5000),
	(2, '2025-03-15', 'USA', 7000),
	(3, '2024-09-01', 'Germany', 4000);

SELECT
	*
FROM
	SALES;

SELECT
	*
FROM
	SALES_2024;

SELECT
	*
FROM
	SALES_2024_INDIA;

-- To get partition
SELECT
	*
FROM
	PG_PARTITION_TREE('sales');

DROP TABLE SALES_2024 CASCADE;

-- Table will no loger part of sales but data still exists
ALTER TABLE SALES DETACH PARTITION SALES_2024;

-- To attach table to partition
ALTER TABLE SALES ATTACH PARTITION SALES_2024 FOR
VALUES
FROM
	('2024-01-01') TO ('2025-01-01');